/**
 * Environment Template Generator
 *
 * Generates .env file templates from account requirements.
 *
 * @module vision/analysis/account/env-template
 */

/**
 * Export environment variable template
 *
 * @param {Array<Object>} requirements - Account requirements
 * @returns {string} .env template with all required variables
 */
export function generateEnvTemplate(requirements) {
  const lines = [
    '# Environment Variables',
    '# Generated by CCASP Vision Mode',
    '',
    '# Copy to .env and fill in your actual values',
    ''
  ];

  const byCategory = {};
  requirements.forEach(req => {
    const category = req.category || 'other';
    if (!byCategory[category]) {
      byCategory[category] = [];
    }
    byCategory[category].push(req);
  });

  Object.entries(byCategory).forEach(([category, reqs]) => {
    lines.push(`# ${category.toUpperCase().replace('-', ' ')}`);

    reqs.forEach(req => {
      lines.push(`# ${req.service} - ${req.accountType}`);

      // Generate variable names based on service
      const envVars = getEnvVariableNames(req.service);
      envVars.forEach(varName => {
        lines.push(`${varName}=your-${varName.toLowerCase().replace(/_/g, '-')}-here`);
      });

      lines.push('');
    });
  });

  return lines.join('\n');
}

/**
 * Get environment variable names for service
 * @private
 */
function getEnvVariableNames(service) {
  const envMap = {
    'Railway': ['RAILWAY_API_TOKEN'],
    'Cloudflare': ['CLOUDFLARE_API_TOKEN', 'CLOUDFLARE_ACCOUNT_ID'],
    'PostgreSQL Database': ['DATABASE_URL'],
    'GitHub': ['GITHUB_TOKEN'],
    'Brave Search API': ['BRAVE_API_KEY'],
    'Slack': ['SLACK_BOT_TOKEN', 'SLACK_SIGNING_SECRET'],
    'Stripe': ['STRIPE_SECRET_KEY', 'STRIPE_PUBLISHABLE_KEY'],
    'SendGrid': ['SENDGRID_API_KEY'],
    'AWS': ['AWS_ACCESS_KEY_ID', 'AWS_SECRET_ACCESS_KEY', 'AWS_REGION'],
    'Redis': ['REDIS_URL'],
    'OpenAI': ['OPENAI_API_KEY'],
    'Anthropic': ['ANTHROPIC_API_KEY']
  };

  return envMap[service] || [`${service.toUpperCase().replace(/\s+/g, '_')}_API_KEY`];
}
