# Golden Master Tests

Characterization tests that capture the current behavior of refactoring candidates before changes.

## Purpose

Golden Master tests (also known as "snapshot tests" or "characterization tests") capture the existing behavior of code before refactoring. This ensures:

1. **No regressions**: After refactoring, the API contracts remain the same
2. **Safe refactoring**: You can confidently restructure code knowing tests will catch breaking changes
3. **Documentation**: The snapshots serve as documentation of the expected API

## Test Files

| File | Description |
|------|-------------|
| `api-contracts.test.js` | Captures all exported functions and their signatures |
| `detect-tech-stack.test.js` | Captures detection behavior for CCASP project |
| `test-runner.js` | Combined test runner for all modules |

## Usage

### Before Refactoring

```bash
# Capture the current state as golden masters
npm run test:golden:capture
```

### After Refactoring

```bash
# Verify the refactored code matches the golden masters
npm run test:golden:verify
```

### Full Test Run

```bash
# Run both capture and verify
npm run test:golden
```

## Snapshots

Golden master snapshots are stored in `tests/golden-master/snapshots/`:

| Snapshot | Contents |
|----------|----------|
| `api-contracts.json` | All exported functions, types, and signatures |
| `detect-tech-stack-ccasp.json` | Detection results for this project |

## What's Tested

### API Contract Tests

For each refactoring candidate, we capture:

- **Export names**: All exported symbols
- **Function signatures**: Parameters, async status, return types
- **Object structures**: Keys and shapes of exported objects

### Modules Covered

| Module | Priority | Exports Captured |
|--------|----------|------------------|
| `claude-settings.js` | 98/100 | `runClaudeSettings` |
| `init.js` | 97/100 | `runInit`, `verifyLegacyInstallation` |
| `claude-audit.js` | 92/100 | `runClaudeAudit`, `showClaudeAuditMenu`, `ENHANCEMENT_TEMPLATES`, `runEnhancement` |
| `menu.js` | 85/100 | `showHeader`, `showSuccess`, `showError`, `showWarning`, `showInfo`, `showMainMenu`, `showProjectSettingsMenu` |
| `setup-wizard.js` | 81/100 | `createBackup`, `runSetupWizard`, `generateSlashCommand` |
| `explore-mcp.js` | 72/100 | `runExploreMcp`, `showExploreMcpMenu`, `showExploreMcpHelp` |
| `detect-tech-stack.js` | 64/100 | `detectTechStack`, `runDetection` |

## Breaking Change Detection

The tests will fail if:

1. **Export removed**: A previously exported function/object is gone
2. **Type changed**: Export changed from function to object (or vice versa)
3. **Async changed**: Function changed from sync to async (or vice versa)
4. **Params removed**: Required parameters were removed

The tests will **not** fail if:

1. **Params added**: New optional parameters (backward compatible)
2. **New exports**: Additional exports added
3. **Internal changes**: Implementation changes that don't affect the API

## Related Issues

These golden master tests support the following refactoring issues:

- [#51](https://github.com/evan043/claude-cli-advanced-starter-pack/issues/51) - claude-settings.js
- [#52](https://github.com/evan043/claude-cli-advanced-starter-pack/issues/52) - init.js
- [#53](https://github.com/evan043/claude-cli-advanced-starter-pack/issues/53) - claude-audit.js
- [#54](https://github.com/evan043/claude-cli-advanced-starter-pack/issues/54) - menu.js
- [#55](https://github.com/evan043/claude-cli-advanced-starter-pack/issues/55) - setup-wizard.js
- [#56](https://github.com/evan043/claude-cli-advanced-starter-pack/issues/56) - explore-mcp.js
- [#57](https://github.com/evan043/claude-cli-advanced-starter-pack/issues/57) - detect-tech-stack.js

---

*Generated by `/refactor-analyze` and `/golden-master` on 2026-02-01*
