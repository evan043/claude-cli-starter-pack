{
  "slug": "ccasp-code-refactoring",
  "title": "CCASP Code Refactoring - Large File Decomposition",
  "description": "Split 11 large files (>1000 lines) identified by refactor-analyze into focused modules. Top targets: orchestrator.js (1900 LOC), menu.js (1873 LOC), init.js (1521 LOC). Goal: reduce all source files to <500 lines, improve codebase health score from 6.5/10 to 8.5/10.",
  "created": "2026-02-06T01:00:00Z",
  "lastUpdated": "2026-02-06T02:00:00Z",
  "status": "in_progress",
  "scale": "L",
  "target_success": 0.95,
  "completion_percentage": 42,

  "parent_epic": null,

  "metadata": {
    "estimated_effort": "3-4 weeks",
    "source": "refactor-analyze comprehensive scan",
    "health_score_before": 6.5,
    "health_score_target": 8.5,
    "total_lines_to_refactor": 12968,
    "files_targeted": 11,
    "parallel_phases_possible": [
      ["1.1", "1.2"],
      ["2.1", "2.2", "2.3"],
      ["3.1", "3.2"]
    ]
  },

  "testing_strategy": {
    "mode": "per-phase",
    "test_command": "npm test",
    "ralph_loop": {
      "enabled": true,
      "maxIterations": 10
    }
  },

  "objectives": [
    "Split orchestrator.js (1900 LOC) into 6 domain-specific modules",
    "Extract menu.js (1873 LOC) into state-machine-based flow modules",
    "Decompose init.js (1521 LOC, 169 functions) into 5 focused submodules",
    "Convert phase-dev-templates.js (1174 LOC) from JS to JSON data files",
    "Split wizard/actions.js (1451 LOC) by action category",
    "Break roadmap-manager.js (1022 LOC) into CRUD + orchestration modules",
    "Decompose schema.js (1053 LOC) into domain-specific schema validators",
    "Maintain 135/135 test pass rate throughout all refactoring"
  ],

  "phases": [
    {
      "id": 1,
      "name": "Safety Nets & Quick Wins",
      "slug": "safety-nets",
      "description": "Establish golden master characterization tests for all refactoring targets, then execute low-risk data extraction (templates to JSON)",
      "status": "completed",
      "completion_percentage": 100,
      "estimated_effort": "2-3 days",
      "priority": "CRITICAL",
      "dependencies": [],
      "tasks": [
        {
          "id": "1.1",
          "description": "Generate golden master snapshots for all 11 target files - capture current API surface and behavior",
          "completed": false,
          "agent": "l2-testing-specialist",
          "files": ["tests/golden-master/"]
        },
        {
          "id": "1.2",
          "description": "Convert phase-dev-templates.js (1174 LOC) to JSON data files - extract template objects to .json, keep JS wrapper thin",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/agents/phase-dev-templates.js", "src/agents/phase-dev-templates/"]
        },
        {
          "id": "1.3",
          "description": "Run npm test - verify 135/135 still pass after template extraction",
          "completed": false,
          "testing": {
            "type": "e2e",
            "command": "npm test"
          }
        }
      ]
    },
    {
      "id": 2,
      "name": "Commands Domain Decomposition",
      "slug": "commands-decompose",
      "description": "Split the 3 largest command files: init.js (1521), wizard/actions.js (1451), and create-phase-dev/wizard.js (864)",
      "status": "completed",
      "completion_percentage": 100,
      "estimated_effort": "4-5 days",
      "priority": "HIGH",
      "dependencies": [1],
      "tasks": [
        {
          "id": "2.1",
          "description": "Split init.js (1521 LOC, 169 functions) into init/{scaffolding,features,templates,deployment,validation}.js - each <300 lines",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/commands/init.js", "src/commands/init/"]
        },
        {
          "id": "2.2",
          "description": "Split wizard/actions.js (1451 LOC) into actions/{setup,agents,hooks,skills,github,deployment}.js by action category",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/commands/wizard/actions.js", "src/commands/wizard/actions/"]
        },
        {
          "id": "2.3",
          "description": "Verify all exports are re-exported from original entry points (backwards compatibility)",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/commands/init.js", "src/commands/wizard/actions.js"]
        },
        {
          "id": "2.4",
          "description": "Run npm test - verify 135/135 still pass after command decomposition",
          "completed": false,
          "testing": {
            "type": "e2e",
            "command": "npm test"
          }
        }
      ]
    },
    {
      "id": 3,
      "name": "CLI & Menu Refactoring",
      "slug": "cli-refactor",
      "description": "Refactor menu.js (1873 LOC, 20+ flows) into state-machine-based architecture with separate flow modules",
      "status": "completed",
      "completion_percentage": 100,
      "estimated_effort": "3-4 days",
      "priority": "HIGH",
      "dependencies": [1],
      "tasks": [
        {
          "id": "3.1",
          "description": "Extract menu.js display utilities (showHeader, showSuccess, showError, etc.) into cli/display.js (<200 lines)",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/cli/menu.js", "src/cli/display.js"]
        },
        {
          "id": "3.2",
          "description": "Extract 20+ menu flows into cli/flows/{main,settings,github,agents,tools,deployment}.js - each <300 lines",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/cli/menu.js", "src/cli/flows/"]
        },
        {
          "id": "3.3",
          "description": "Reduce menu.js to thin orchestrator (<300 lines) that imports flows and display utils",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/cli/menu.js"]
        },
        {
          "id": "3.4",
          "description": "Run npm test - verify 135/135 still pass after menu refactoring",
          "completed": false,
          "testing": {
            "type": "e2e",
            "command": "npm test"
          }
        }
      ]
    },
    {
      "id": 4,
      "name": "Roadmap Domain Decomposition",
      "slug": "roadmap-decompose",
      "description": "Split roadmap-manager.js (1022), schema.js (1053), and intelligence.js (954) into focused modules",
      "status": "pending",
      "completion_percentage": 0,
      "estimated_effort": "3-4 days",
      "priority": "MEDIUM",
      "dependencies": [1],
      "tasks": [
        {
          "id": "4.1",
          "description": "Split schema.js (1053 LOC, 28 exports) into schema/{validators,generators,migrations}.js",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/roadmap/schema.js", "src/roadmap/schema/"]
        },
        {
          "id": "4.2",
          "description": "Split roadmap-manager.js (1022 LOC) into roadmap/{crud,lifecycle,queries}.js",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/roadmap/roadmap-manager.js", "src/roadmap/manager/"]
        },
        {
          "id": "4.3",
          "description": "Split intelligence.js (954 LOC) into intelligence/{analyzer,recommender,classifier}.js",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/roadmap/intelligence.js", "src/roadmap/intelligence/"]
        },
        {
          "id": "4.4",
          "description": "Run npm test - verify 135/135 still pass after roadmap decomposition",
          "completed": false,
          "testing": {
            "type": "e2e",
            "command": "npm test"
          }
        }
      ]
    },
    {
      "id": 5,
      "name": "Vision Orchestrator Decomposition",
      "slug": "vision-decompose",
      "description": "Split the largest file - orchestrator.js (1900 LOC) - into 6 domain-specific orchestration modules",
      "status": "pending",
      "completion_percentage": 0,
      "estimated_effort": "4-5 days",
      "priority": "HIGH",
      "dependencies": [1],
      "tasks": [
        {
          "id": "5.1",
          "description": "Identify the 8 subsystem domains in orchestrator.js and map functions to domains",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/orchestrator.js"]
        },
        {
          "id": "5.2",
          "description": "Extract analysis/security/architecture orchestration into vision/orchestrators/{analysis,security,architecture}.js",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/orchestrator.js", "src/vision/orchestrators/"]
        },
        {
          "id": "5.3",
          "description": "Extract autonomous/execution orchestration into vision/orchestrators/{autonomous,execution,monitoring}.js",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/orchestrator.js", "src/vision/orchestrators/"]
        },
        {
          "id": "5.4",
          "description": "Reduce orchestrator.js to thin coordinator (<400 lines) importing domain modules",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/orchestrator.js"]
        },
        {
          "id": "5.5",
          "description": "Run npm test - verify 135/135 still pass after vision decomposition",
          "completed": false,
          "testing": {
            "type": "e2e",
            "command": "npm test"
          }
        }
      ]
    },
    {
      "id": 6,
      "name": "Agents & Utils Cleanup",
      "slug": "agents-utils",
      "description": "Refactor remaining high-priority files in agents (state-manager, generator, spawner) and utils (version-check) domains",
      "status": "pending",
      "completion_percentage": 0,
      "estimated_effort": "2-3 days",
      "priority": "MEDIUM",
      "dependencies": [2, 3, 4, 5],
      "tasks": [
        {
          "id": "6.1",
          "description": "Split agents/state-manager.js (851 LOC) into state/{store,queries,mutations}.js",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/agents/state-manager.js"]
        },
        {
          "id": "6.2",
          "description": "Split agents/generator.js (832 LOC) into generator/{l1,l2,l3,common}.js by agent level",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/agents/generator.js"]
        },
        {
          "id": "6.3",
          "description": "Split utils/version-check.js (925 LOC) into version/{checker,updater,registry}.js",
          "completed": false,
          "agent": "l2-backend-specialist",
          "files": ["src/utils/version-check.js"]
        },
        {
          "id": "6.4",
          "description": "Run full test suite + golden master verification",
          "completed": false,
          "testing": {
            "type": "e2e",
            "command": "npm test && node tests/golden-master/test-runner.js verify"
          }
        }
      ]
    },
    {
      "id": 7,
      "name": "Verification & Polish",
      "slug": "verification",
      "description": "Final verification pass - all files <500 lines, tests pass, lint clean, golden masters match",
      "status": "pending",
      "completion_percentage": 0,
      "estimated_effort": "1-2 days",
      "priority": "LOW",
      "dependencies": [6],
      "tasks": [
        {
          "id": "7.1",
          "description": "Verify ALL 11 original files are now <500 lines (or replaced by thin re-export wrappers)",
          "completed": false,
          "agent": "l2-testing-specialist",
          "files": ["src/"]
        },
        {
          "id": "7.2",
          "description": "Run full test suite - verify 135/135 pass",
          "completed": false,
          "testing": {
            "type": "e2e",
            "command": "npm test"
          }
        },
        {
          "id": "7.3",
          "description": "Run npm run lint - verify no new errors introduced",
          "completed": false,
          "testing": {
            "type": "lint",
            "command": "npm run lint"
          }
        },
        {
          "id": "7.4",
          "description": "Run /refactor-analyze to measure new health score (target: 8.5/10)",
          "completed": false,
          "agent": "l2-testing-specialist"
        },
        {
          "id": "7.5",
          "description": "Update CHANGELOG.md with refactoring changes",
          "completed": false,
          "agent": "l2-specialist",
          "files": ["CHANGELOG.md"]
        }
      ]
    }
  ]
}
