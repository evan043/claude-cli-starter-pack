{
  "slug": "refactor-domains",
  "title": "Epic 2: Domain Modules - Agents, Vision, Orchestration & PM",
  "description": "Second epic in the 500 LOC refactor series. Decomposes domain-specific modules: PM-hierarchy, roadmap integration, agents, vision subsystem, orchestration, VDB, and analysis. Depends on Epic 1 (Foundation) completing first.",
  "created": "2026-02-06T09:00:00Z",
  "lastUpdated": "2026-02-05T23:00:00Z",
  "status": "completed",
  "scale": "L",
  "target_success": 0.95,
  "completion_percentage": 100,
  "parent_epic": "ccasp-500loc-refactor",
  "metadata": {
    "estimated_effort": "2-3 weeks",
    "source": "ccasp-500loc-refactor epic split",
    "files_targeted": 26,
    "total_lines_to_refactor": 17900,
    "technique": "thin-re-export-pattern",
    "blocking_prerequisites": ["refactor-foundation"],
    "github_integrated": true,
    "github_epic_number": 100,
    "github_issue_number": 102
  },
  "testing_strategy": {
    "mode": "per-phase",
    "test_command": "npm test",
    "golden_master_command": "npm run test:golden:verify",
    "ralph_loop": {
      "enabled": true,
      "maxIterations": 10
    }
  },
  "objectives": [
    "Decompose 7 PM-hierarchy/roadmap files to under 500 LOC each",
    "Decompose 4 agent files to under 500 LOC each",
    "Decompose 8 vision files to under 500 LOC each",
    "Decompose 7 orchestration/VDB/analysis files to under 500 LOC each",
    "Maintain all tests and golden master contracts"
  ],
  "phases": [
    {
      "id": 1,
      "name": "PM-Hierarchy & Roadmap Integration",
      "slug": "pm-hierarchy-roadmap",
      "description": "Refactor PM hierarchy schema/adapters and roadmap integration modules that depend on GitHub foundation.",
      "status": "completed",
      "completion_percentage": 100,
      "commit": "ff7f41f",
      "estimated_effort": "3-4 days",
      "priority": "HIGH",
      "dependencies": [],
      "tasks": [
        {
          "id": "1.1",
          "description": "Split src/pm-hierarchy/schema.js (724 LOC) into pm-hierarchy/schema/{definitions,validators,migrations}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/pm-hierarchy/schema.js"]
        },
        {
          "id": "1.2",
          "description": "Split src/pm-hierarchy/integrations/linear-adapter.js (575 LOC) into linear/{client,sync,mapper}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/pm-hierarchy/integrations/linear-adapter.js"]
        },
        {
          "id": "1.3",
          "description": "Split src/pm-hierarchy/integration-wizard.js (509 LOC) into integration-wizard/{ui,config,executor}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/pm-hierarchy/integration-wizard.js"]
        },
        {
          "id": "1.4",
          "description": "Split src/roadmap/github-integration.js (912 LOC) into roadmap/github/{issue-creator,sync,labels,comments}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/roadmap/github-integration.js"]
        },
        {
          "id": "1.5",
          "description": "Split src/roadmap/multi-project-builder.js (757 LOC) into roadmap/multi-project/{analyzer,builder,merger}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/roadmap/multi-project-builder.js"]
        },
        {
          "id": "1.6",
          "description": "Split src/roadmap/phase-generator.js (602 LOC) into roadmap/phase-gen/{analyzer,generator,validator}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/roadmap/phase-generator.js"]
        },
        {
          "id": "1.7",
          "description": "Split src/roadmap/executor.js (501 LOC) into roadmap/executor/{runner,state,reporter}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/roadmap/executor.js"]
        },
        {
          "id": "1.8",
          "description": "Run npm test + golden master verify",
          "completed": true,
          "testing": {
            "type": "e2e",
            "command": "npm test && npm run test:golden:verify"
          }
        }
      ]
    },
    {
      "id": 2,
      "name": "Agents Domain",
      "slug": "agents-domain",
      "description": "Refactor agent spawning, templates, and content generation modules.",
      "status": "completed",
      "completion_percentage": 100,
      "commit": "2b828d8",
      "estimated_effort": "2-3 days",
      "priority": "HIGH",
      "dependencies": [],
      "tasks": [
        {
          "id": "2.1",
          "description": "Split src/agents/spawner.js (790 LOC) into agents/spawner/{l2-spawner,l3-spawner,config,monitor}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/agents/spawner.js"]
        },
        {
          "id": "2.2",
          "description": "Split src/agents/templates.js (679 LOC) into agents/templates/{l1-templates,l2-templates,l3-templates,common}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/agents/templates.js"]
        },
        {
          "id": "2.3",
          "description": "Split src/agents/generator/content-generators.js (645 LOC) into generator/content/{prompts,configs,validators}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/agents/generator/content-generators.js"]
        },
        {
          "id": "2.4",
          "description": "Split src/agents/testing-scout.js (532 LOC) into agents/testing-scout/{scanner,reporter,recommender}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/agents/testing-scout.js"]
        },
        {
          "id": "2.5",
          "description": "Run npm test + golden master verify",
          "completed": true,
          "testing": {
            "type": "e2e",
            "command": "npm test && npm run test:golden:verify"
          }
        }
      ]
    },
    {
      "id": 3,
      "name": "Vision Domain",
      "slug": "vision-domain",
      "description": "Refactor the vision subsystem (8 files, 4,910 LOC). Strict ordering: schema -> state-manager -> agent-factory -> orchestrators -> ui.",
      "status": "completed",
      "completion_percentage": 100,
      "commit": "a17d207",
      "estimated_effort": "4-5 days",
      "priority": "MEDIUM",
      "dependencies": [2],
      "tasks": [
        {
          "id": "3.1",
          "description": "Split src/vision/schema.js (577 LOC) into vision/schema/{definitions,validators,migrations}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/schema.js"]
        },
        {
          "id": "3.2",
          "description": "Split src/vision/state-manager.js (745 LOC) into vision/state/{store,queries,persistence}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/state-manager.js"]
        },
        {
          "id": "3.3",
          "description": "Split src/vision/agent-factory.js (779 LOC) into vision/agent-factory/{builder,registry,templates}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/agent-factory.js"]
        },
        {
          "id": "3.4",
          "description": "Split src/vision/observer.js (604 LOC) into vision/observer/{event-bus,watchers,reporters}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/observer.js"]
        },
        {
          "id": "3.5",
          "description": "Split src/vision/analysis/account-detector.js (553 LOC) into analysis/account/{scanner,classifier,validator}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/analysis/account-detector.js"]
        },
        {
          "id": "3.6",
          "description": "Split src/vision/orchestrators/planning.js (520 LOC) into planning/{strategy,breakdown,estimator}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/orchestrators/planning.js"]
        },
        {
          "id": "3.7",
          "description": "Split src/vision/architecture/api-contracts.js (507 LOC) into architecture/api/{definitions,generators,validators}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/architecture/api-contracts.js"]
        },
        {
          "id": "3.8",
          "description": "Split src/vision/ui/ascii-generator.js (625 LOC) into ui/ascii/{dashboard,progress-bar,tables,boxes}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vision/ui/ascii-generator.js"]
        },
        {
          "id": "3.9",
          "description": "Run npm test + golden master verify",
          "completed": true,
          "testing": {
            "type": "e2e",
            "command": "npm test && npm run test:golden:verify"
          }
        }
      ]
    },
    {
      "id": 4,
      "name": "Orchestration & Cross-Cutting",
      "slug": "orchestration-cross-cutting",
      "description": "Refactor integration layers: orchestration, epic, phase-dev reporting, VDB, and analysis modules.",
      "status": "completed",
      "completion_percentage": 100,
      "commit": "43c8cae",
      "estimated_effort": "3-4 days",
      "priority": "MEDIUM",
      "dependencies": [1, 2],
      "tasks": [
        {
          "id": "4.1",
          "description": "Split src/orchestration/progress-aggregator.js (701 LOC) into orchestration/progress/{collector,calculator,reporter}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/orchestration/progress-aggregator.js"]
        },
        {
          "id": "4.2",
          "description": "Split src/epic/state-manager.js (635 LOC) into epic/state/{store,queries,transitions}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/epic/state-manager.js"]
        },
        {
          "id": "4.3",
          "description": "Split src/phase-dev/completion-reporter.js (683 LOC) into phase-dev/reporter/{summary,metrics,github-sync}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/phase-dev/completion-reporter.js"]
        },
        {
          "id": "4.4",
          "description": "Split src/vdb/decision-engine.js (889 LOC) into vdb/decision/{analyzer,scorer,recommender,executor}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vdb/decision-engine.js"]
        },
        {
          "id": "4.5",
          "description": "Split src/vdb/board-sync.js (692 LOC) into vdb/board/{scanner,differ,syncer}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/vdb/board-sync.js"]
        },
        {
          "id": "4.6",
          "description": "Split src/analysis/competitor-analysis.js (669 LOC) into analysis/competitor/{scraper,comparator,reporter}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/analysis/competitor-analysis.js"]
        },
        {
          "id": "4.7",
          "description": "Split src/analysis/codebase.js (502 LOC) into analysis/codebase/{scanner,metrics,reporter}.js",
          "completed": true,
          "agent": "l2-backend-specialist",
          "files": ["src/analysis/codebase.js"]
        },
        {
          "id": "4.8",
          "description": "Run npm test + golden master verify",
          "completed": true,
          "testing": {
            "type": "e2e",
            "command": "npm test && npm run test:golden:verify"
          }
        }
      ]
    }
  ]
}
